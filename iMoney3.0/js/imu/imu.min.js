function imuInit(t){return t?void $(t).each(function(){imuHandler().handle(this)}):void $("*[data-imu-track]").each(function(t){var a=$(this).data("imu-track");$(this).find(a).each(function(){imuHandler().handle(this)})})}var socketManager={socket:null,init:function(){this.socket=io.connect("https://im.imoney.my")}},IMUTrack=function(t){var a=this;this.timestamp=(new Date).getTime(),this.language=jQuery("html").attr("lang"),this.url=window.location.href,this.useragent=navigator.userAgent,this.synced=!1,_.each(t,function(t,e){a[e]=t})},IMUTrackFactory=function(){var t="imu";return{getAll:function(){return store.get(t)},getAllUnsynced:function(){return _.where(this.getAll(),{synced:!1})},setIsSynced:function(a,e){var n=this.getAll();_.each(n,function(t,i){t.timestamp==a&&(n[i].synced=e)}),store.set(t,n),this.removeSynced()},add:function(a){var e=this.getAll()||[];e.push(a),store.set(t,e)},removeSynced:function(a){list=a?_.reject(this.getAll(),function(t){return t.timestamp==a}):_.reject(this.getAll(),function(t){return 1==t.synced}),store.set(t,list)}}}(),userManager={data:{id:null,tracks:IMUTrackFactory.getAllUnsynced()},init:function(){this.data.id=jQuery.cookie("userId")},identifyUser:function(){var t=this;this.data.keywords=this.getPageKeywords(),socketManager.socket.json.send({type:"track",data:t.data})},setUser:function(t){this.data=t,jQuery.cookie("userId",this.data.id,{expires:365,path:"/"})},getPageKeywords:function(){var t=[];return jQuery('meta[name="keywords"]')&&jQuery('meta[name="keywords"]').attr("content")&&(t=jQuery('meta[name="keywords"]').attr("content").split(",")),t},track:function(t){"undefined"==typeof this.data.tracks&&(this.data.tracks=[]),this.data.tracks.push(t),IMUTrackFactory.add(t),socketManager.socket.json.send({type:"track",data:this.data}),console.log({region:t.region,vertical:t.vertical,action:t.action,value:t.value})}};jQuery(function(){"use strict";socketManager.init(),userManager.init(),socketManager.socket.on("connect",function(){var t=new IMUTrack({action:"user-visit"});userManager.track(t),socketManager.socket.on("track",function(t){t&&(userManager.setUser(t),_.each(t.synced,function(t,a){IMUTrackFactory.setIsSynced(t,!0)}))}),socketManager.socket.on("disconnect",function(){console.log("Disconnected from IMU")})}),$("select.imu-track").change(function(){if("undefined"!=typeof userManager){var t=new IMUTrack({region:$(this).data("region"),action:$(this).data("action"),vertical:$(this).data("vertical"),value:$(this).val()});userManager.track(t)}}),$("button.imu-track, a.imu-track").click(function(){imuTrackEvent.apply(this,arguments)}),$("input.imu-track[type=text]").blur(function(){imuTrackEvent.apply(this,arguments)}),imuInit();var imuTrackEvent=function(){if("undefined"!=typeof userManager){var dataval=$(this).data("value");dataval.length>0&&"$"==dataval.charAt(0)&&(dataval=eval(dataval));var imuTrack=new IMUTrack({region:$(this).data("region"),action:$(this).data("action"),vertical:$(this).data("vertical"),value:dataval});userManager.track(imuTrack)}}});