function imuInit(t){return t?void $(t).each(function(){imuHandler().handle(this)}):void $("*[data-imu-track]").each(function(t){var e=$(this).data("imu-track");$(this).find(e).each(function(){imuHandler().handle(this)})})}var socketManager={socket:null,init:function(){this.socket=io.connect("https://im.imoney.my")}},IMUTrack=function(t){var e=this;this.timestamp=(new Date).getTime(),this.language=jQuery("html").attr("lang"),this.url=window.location.href,this.useragent=navigator.userAgent,this.synced=!1,_.each(t,function(t,a){e[a]=t})},IMUTrackFactory=function(){var t="imu",e=[];return{getAll:function(){return store.enabled?store.get(t):e},getAllUnsynced:function(){return _.where(this.getAll(),{synced:!1})},setIsSynced:function(a,n){var i=this.getAll();_.each(i,function(t,e){t.timestamp==a&&(i[e].synced=n)}),store.enabled?store.set(t,i):e=_.clone(i),this.removeSynced()},add:function(a){var n=this.getAll()||[];n.push(a),store.enabled?store.set(t,n):e=_.clone(n)},removeSynced:function(a){list=a?_.reject(this.getAll(),function(t){return t.timestamp==a}):_.reject(this.getAll(),function(t){return 1==t.synced}),store.enabled?store.set(t,list):e=_.clone(list)}}}(),userManager={data:{id:null,tracks:IMUTrackFactory.getAllUnsynced()},init:function(){this.data.id=jQuery.cookie("userId")},identifyUser:function(){var t=this;this.data.keywords=this.getPageKeywords(),socketManager.socket.json.send({type:"track",data:t.data})},setUser:function(t){this.data=t,jQuery.cookie("userId",this.data.id,{expires:365,path:"/"})},getPageKeywords:function(){var t=[];return jQuery('meta[name="keywords"]')&&jQuery('meta[name="keywords"]').attr("content")&&(t=jQuery('meta[name="keywords"]').attr("content").split(",")),t},track:function(t){"undefined"==typeof this.data.tracks&&(this.data.tracks=[]),this.data.tracks.push(t),IMUTrackFactory.add(t),socketManager.socket.json.send({type:"track",data:this.data}),console.log({region:t.region,vertical:t.vertical,subject:t.subject,action:t.action,description:t.description,value:t.value})}};jQuery(function(){"use strict";socketManager.init(),userManager.init(),socketManager.socket.on("connect",function(){var t=new IMUTrack({subject:"User",action:"Visit"});userManager.track(t),socketManager.socket.on("track",function(t){t&&(userManager.setUser(t),_.each(t.synced,function(t,e){IMUTrackFactory.setIsSynced(t,!0)}))}),socketManager.socket.on("disconnect",function(){console.log("Disconnected from IMU")})}),$("select.imu-track").change(function(){if("undefined"!=typeof userManager){var t=new IMUTrack({region:$(this).data("region"),subject:$(this).data("subject"),action:$(this).data("action"),description:$(this).data("description"),vertical:$(this).data("vertical"),value:$(this).val()});userManager.track(t)}}),$("button.imu-track, a.imu-track").click(function(){imuTrackEvent.apply(this,arguments)}),$("input.imu-track[type=text]").blur(function(){imuTrackEvent.apply(this,arguments)}),imuInit();var imuTrackEvent=function(){if("undefined"!=typeof userManager){var dataval=$(this).data("value");dataval.length>0&&"$"==dataval.charAt(0)&&(dataval=eval(dataval));var imuTrack=new IMUTrack({region:$(this).data("region"),subject:$(this).data("subject"),action:$(this).data("action"),description:$(this).data("description"),vertical:$(this).data("vertical"),value:dataval});userManager.track(imuTrack)}}});